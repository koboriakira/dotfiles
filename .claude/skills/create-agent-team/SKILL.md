---
name: create-agent-team
description: Claude Code のエージェントチーム構成を設計・提案するスキル。エージェントチーム作成、複数エージェントの協調作業、並行チーム作業の設計を依頼されたときに使用する。
disable-model-invocation: true
argument-hint: "[タスクの概要]"
allowed-tools: Read, Write, Edit, Bash, Glob, Grep, AskUserQuestion
---

# エージェントチーム作成スキル

Claude Code のエージェントチーム機能を活用したチーム構成を設計・提案する。

## エージェントチームとは

複数の Claude Code インスタンスがチームとして協調動作する仕組み。
1つのセッションがチームリードとなり、チームメイトに作業を割り当て、結果を統合する。

> **実験的機能**: `CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS` の有効化が必要。

**サブエージェントとの違い:**

| 項目 | サブエージェント | エージェントチーム |
|------|-------------|----------------|
| コンテキスト | 独立。結果を親に返す | 完全に独立 |
| 通信 | 親への報告のみ | メンバー間の直接通信 |
| 調整 | 親が全管理 | 共有タスクリストで自己調整 |
| 最適な用途 | 結果だけ必要な集中タスク | 議論・協調が必要な複雑な作業 |
| トークンコスト | 低（結果を要約して返す） | 高（各メンバーが独立インスタンス） |

## 作成フロー

### 1. タスク分析

ユーザのタスクを分析し、以下を判断する:

**エージェントチームが適切なケース:**
- 並行探索に価値がある（リサーチ、レビュー）
- 新しいモジュール・機能を並行開発
- 競合仮説のデバッグ
- フロントエンド・バックエンド・テストの横断的変更

**エージェントチームが不適切なケース（サブエージェントを推奨）:**
- 順次的なタスク
- 同一ファイルの編集
- 依存関係が多い作業
- トークンコストを抑えたい場合

不適切な場合はその旨を伝え、サブエージェントの利用を提案する。

### 2. 要件の収集

以下を `AskUserQuestion` で確認する:

**必須:**
- タスクの全体像
- チームの目的

**推奨:**
- チームメイトの構成（役割・人数）
- 各チームメイトに使用するモデル
- 表示モード（in-process / split panes）
- プラン承認の要否

### 3. チーム構成の設計

以下をユーザに提案する:

1. **チームメイトの役割分担** — 各メンバーの専門領域と責任
2. **タスク分割** — 並行実行可能な独立したタスク
3. **コミュニケーション計画** — どのメンバー間で情報共有が必要か
4. **品質ゲート** — フック等による品質保証の仕組み

### 4. プロンプトの生成

設計に基づき、チーム起動用のプロンプトを生成する。
テンプレートと例は [reference.md](reference.md) と [examples/](examples/) を参照。

### 5. 環境設定の確認

以下の設定が必要な場合、ユーザに案内する:

#### 機能の有効化

`settings.json` に追加が必要:
```json
{
  "env": {
    "CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1"
  }
}
```

#### 表示モードの設定（任意）

```json
{
  "teammateMode": "in-process"
}
```

- `auto` — tmux セッション内なら split panes、それ以外は in-process（デフォルト）
- `in-process` — メインターミナル内（Shift+Down でメンバー切替）
- `tmux` — split panes（tmux または iTerm2 が必要）

#### フックの設定（任意）

`TeammateIdle` と `TaskCompleted` フックで品質ゲートを設定可能。

### 6. 生成後の案内

- チーム起動用プロンプト
- 操作方法:
  - `Shift+Down` でメンバー間を移動
  - `Ctrl+T` でタスクリスト表示
  - メンバーに直接メッセージ送信可能
- チーム終了手順（リードからシャットダウン→クリーンアップ）
- 注意事項・制約

## チーム設計のベストプラクティス

### メンバー構成

- 各メンバーに**明確な専門領域**を割り当てる
- 同一ファイルを複数メンバーが編集しないよう分担する
- 1メンバーあたり5〜6タスクが適切

### タスクサイズ

- 小さすぎ: 調整コストが利益を上回る
- 大きすぎ: チェックポイントなしで長時間作業
- 適切: 明確な成果物を生む自己完結型の単位

### コンテキスト

- チームメイトはリードの会話履歴を引き継がない
- スポーンプロンプトにタスク固有の詳細を含める
- CLAUDE.md はプロジェクトコンテキストとして自動読み込みされる

## 制約

- 1セッション1チーム
- チームのネストは不可（メンバーが自チームを作成できない）
- リードは固定（移譲不可）
- メンバーの権限モードはスポーン後に個別変更可能だが、スポーン時指定は不可
- セッション再開時に in-process メンバーは復元されない
