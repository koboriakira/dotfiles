---
name: create-subagent
description: Claude Code のカスタムサブエージェントを作成するスキル。サブエージェント作成、エージェント定義、特化型エージェントの構築を依頼されたときに使用する。
disable-model-invocation: true
argument-hint: "[サブエージェント名] [概要]"
allowed-tools: Read, Write, Edit, Bash, Glob, Grep, AskUserQuestion
---

# サブエージェント作成スキル

Claude Code のサブエージェント仕様に準拠したカスタムサブエージェントを作成する。

## サブエージェントとは

サブエージェントは、特定のタスクを処理する特化型AIアシスタント。
各サブエージェントは独自のコンテキストウィンドウで実行され、カスタムシステムプロンプト・ツールアクセス・独立した権限を持つ。

**サブエージェント vs スキル vs エージェントチーム:**

| 機能 | サブエージェント | スキル | エージェントチーム |
|------|-------------|--------|----------------|
| コンテキスト | 独立したウィンドウ | メイン会話内 | 各メンバー独立 |
| 通信 | 結果を親に返す | インライン実行 | メンバー間で直接通信 |
| 用途 | 重い処理の分離 | 知識・ワークフロー注入 | 並行協調作業 |

## 作成フロー

### 1. 要件の収集

以下をユーザから確認する。不足している場合は `AskUserQuestion` で質問する。

**必須:**
- サブエージェント名（kebab-case、小文字・ハイフンのみ）
- 目的と専門分野
- 対象タスクの説明

**推奨:**
- 使用を許可するツール（tools）
- 使用モデル（model）
- 権限モード（permissionMode）

**任意:**
- プリロードするスキル（skills）
- 永続メモリ（memory）のスコープ
- ライフサイクルフック（hooks）
- 拒否するツール（disallowedTools）

### 2. 設計判断

#### モデル選択

| モデル | 用途 |
|--------|------|
| `haiku` | 高速・低コスト。コードベース探索、簡易タスク |
| `sonnet` | バランス型。コードレビュー、分析 |
| `opus` | 高精度。複雑な推論、アーキテクチャ設計 |
| `inherit` | 親と同じモデル（デフォルト） |

#### ツール設計

最小権限の原則に従う:

- **読み取り専用**: `Read, Grep, Glob` — レビュー、調査向け
- **読み取り+Bash**: `Read, Grep, Glob, Bash` — テスト実行、データ分析向け
- **全ツール**: 省略（全継承）— 実装・修正向け
- **Bash パターン制限**: `Bash(npm:*), Bash(git:*)` — 特定コマンドのみ

#### 権限モード

| モード | 説明 | 用途 |
|--------|------|------|
| `default` | 標準の権限チェック | 通常のサブエージェント |
| `acceptEdits` | ファイル編集を自動承認 | 信頼できる実装エージェント |
| `dontAsk` | 権限プロンプトを自動拒否 | 安全な読み取り専用エージェント |
| `plan` | 読み取り専用（Plan mode） | 調査・計画エージェント |

### 3. 保存先の決定

| 場所 | パス | 用途 |
|------|------|------|
| プロジェクト | `.claude/agents/<name>.md` | このプロジェクトのみ（チーム共有可） |
| 個人用 | `~/.claude/agents/<name>.md` | 全プロジェクトで使用 |

ユーザに確認して適切な場所を選択する。

### 4. ファイル生成

サブエージェントのMarkdownファイルを生成する。

フロントマターとテンプレートの詳細は [reference.md](reference.md) を参照。
具体的な例は [examples/](examples/) を参照。

### 5. 生成後の確認

作成後、以下を提示する:

- 作成したファイルのパス
- テスト方法:
  - `/agents` コマンドで存在確認
  - 「〜サブエージェントを使って...」で明示的に呼び出し
  - 関連タスクで自動委譲されるか確認
- description の改善提案（自動委譲の精度向上）

## description の書き方ガイドライン

description は Claude が自動委譲を判断する最も重要な要素。

**良い description の特徴:**
- 「いつ使うか」が明確
- 具体的なキーワードを含む
- `Use proactively` を含めると積極的に委譲される

良い例:
```
Expert code review specialist. Proactively reviews code for quality, security, and maintainability. Use immediately after writing or modifying code.
```

悪い例:
```
コードレビューのエージェント
```

## 制約

- サブエージェントは他のサブエージェントを生成できない（ネスト不可）
- 親が `bypassPermissions` の場合、サブエージェントの権限モードは上書きできない
- MCP ツールはバックグラウンドサブエージェントでは利用不可
- セキュリティに配慮する（認証情報の扱い、外部アクセスの制限等）
